
    <div ng-app="adduser">
      <!-- Content Header (Page header) -->
      <section class="content-header">
        <div class="container-fluid">
          <div class="row mb-2">
            <div class="col-sm-6">
              <h1>Update User</h1>
            </div>
            <div class="col-sm-6">
              <ol class="breadcrumb float-sm-right">
                <li class="breadcrumb-item"><a href="#">Home</a></li>
                <li class="breadcrumb-item active">Add User</li>
              </ol>
            </div>
          </div>
        </div><!-- /.container-fluid -->
      </section>
  
      <!-- Main content -->
      <section class="content">
        <div class="container-fluid">
          <div id="loader" style="display: none;"></div>
          <div class="row">
            <!-- left column -->
            <div class="col-md-12">
              <!-- general form elements -->
              <div class="card card-primary" >
                <div class="card-header" style="background-color: #048db7 !important;">
                  <h3 class="card-title">Update User</h3>
                  <!-- <div id="loader" style="display: none;"></div> -->
                </div>
                <!-- /.card-header -->
                <!-- form start -->
                <form id="form" name="form" enctype="multipart/form-data" ng-controller="adduserController" ng-submit="submitForm()">
                  <div class="card-body">
                    <div class="row">
                      <div class="col-md-6">
                       <div class="form-group">
                          <label>First Name <span style="color:red;">*</span></label>
                          <input type="text" name="firstname" id="firstname"  class="form-control" placeholder="First Name" ng-model="user.firstname" required>
                          <span class="error" ng-show="form.firstname.$dirty && form.firstname.$error.required">Enter Your First Name!.</span>
                          
                        </div>
                      </div>
                      <div class="col-md-6">
                        <div class="form-group">
                          <label>Last Name <span style="color:red;">*</span></label>
                          <input type="text" name="lastname" id="lastname"  class="form-control" placeholder="Last Name" ng-model="user.lastname" required>
                          <input type="hidden" name="userid" id="userid"  class="form-control" ng-model="user.userid">

                          <span class="error" ng-show="form.lastname.$dirty && form.lastname.$error.required">Enter Your Last Name!.</span>
                        </div>
                      </div>
                    </div>
                    <div class="row">
                      <div class="col-md-6">
                         <div class="form-group">
                          <label>Phone No <span style="color:red;">*</span></label>
                          <input type="number" name="phone_no" id="phone_no"  class="form-control" placeholder="Phone No" ng-model="user.phone_no" required ng-minlength="10" ng-maxlength="10" >
                          <span class="error" ng-show="form.phone_no.$dirty && form.phone_no.$error.required && form.phone_no.$error.number">Enter Valid Phone Number!.</span>
                          <span class="error" ng-show="(form.phone_no.$dirty && (form.phone_no.$error.minlength || form.phone_no.$error.maxlength))">Phone Number should be 10 digits!.</span>
                          

                        </div>
                      </div>
                      <div class="col-md-6">
                        <div class="form-group">
                          <label>Email <span style="color:red;">*</span></label>
                          <input type="email" name="email" id="email"  class="form-control" placeholder="Email" ng-model="user.email" required readonly>
                          <span class="error" ng-show="form.email.$dirty && form.email.$error.required">Enter Your Email Address!.</span>
                          <span class="error" ng-show="form.email.$dirty && form.email.$error.email">Enter Your Valid Email Address!.</span>
                        </div>
                      </div>
                    </div>
  
                    <div class="row">
                      <div class="col-md-6">
                        <div class="form-group">
                          <label for="exampleInputPassword1">Select PCMH <span style="color:red;">*</span></label>
                          <select name="pcmh" id="pcmh" class="form-control" ng-model="user.pcmh" >
                            <option value="">--Select--</option>
                            <!-- <option value="PCMH1">PCMH1</option>
                            <option value="PCMH2">PCMH2</option>
                            <option value="PCMH3">PCMH3</option> -->
                          </select>
                          <!-- <span class="error" ng-show="form.pcmh.$dirty && form.pcmh.$error.required">Select PCMH!.</span> -->
                        </div>
                      </div>
                      <div class="col-md-6">
                         
                        <div class="form-group">
                          <label for="exampleInputaddress">Address <span style="color:red;">*</span></label>
                          <textarea class="form-control" id="address" name="address" rows="2" placeholder="Address" ng-model="user.address" required></textarea>
                          <span class="error" ng-show="form.address.$dirty && form.address.$error.required">Enter Your Address!.</span>
                        </div>
                      </div>
                     
                    </div>
  
                    <div class="row">

                      <div class="col-md-6">
                        <div class="form-group">
                          <label for="exampleInputPassword1">Select User Type <span style="color:red;">*</span></label>
                          <select name="usertype" id="usertypes" class="form-control" ng-model="user.usertype" >
                            <option value="">--Select--</option>
                           
                          </select>
                         
                        </div>
                      </div>

                      <div class="col-md-6">
                        <div class="form-group">
                          <label>User ID <span style="color:red;">*</span></label>
                          <input type="text" name="pcmh_user_id" id="pcmh_user_id"  class="form-control" placeholder="PCMH User ID" ng-model="pcmh.pcmh_user_id" required readonly>
                          <span class="error" ng-show="form.pcmh_user_id.$dirty && form.pcmh_user_id.$error.required">Enter PCMH User ID!.</span>
                        </div>
                        
                      </div>
                     
                     
                      
                    </div>
                    <div class="row">
                     
                      <div class="col-md-6">
                        <div class="form-group">
                          <label for="exampleInputPassword">Password <span style="color:red;">*</span></label>
                          <input type="password" class="form-control" id="password" name="password" placeholder="Password" ng-model="user.password" required>
                          <span class="error" ng-show="form.password.$dirty && form.password.$error.required">Enter Your Password!.</span>
                        </div>
                      </div>
  
                     
                      
                    </div>
                    <br>
                    <div class="row">
                      
                      <div class="col-md-12" style="text-align: center;">
                        <input type="submit" id="submit" name="submit" class="btn btn-primary" value="Submit" >
                        <button type="reset" id="reset" name="reset" ng-click="resetForm()" class="btn btn-danger">Cancel</button>
                      </div>
                    </div>
                    <br>
                  </div>
                  <!-- /.card-body -->
  
                  
                </form>
  
               
              </div>
              <!-- /.card -->
            </div>
          </div>
  
          <div id="result"></div>
          <!-- /.row -->
        </div><!-- /.container-fluid -->
      </section>
      <!-- /.content -->
    </div>
    <!-- /.content-wrapper -->
    <script src="../dist/js/angular.min.js"></script>
  <script type="text/javascript">
  $(document).ready(function () {
    bsCustomFileInput.init();
    var usertype=sessionStorage.getItem("usertype");
    var username=sessionStorage.getItem("username");
    var userid = sessionStorage.getItem("edited_userid");
    GetUserata(userid);

  document.getElementById('usertype').innerHTML=usertype;
  document.getElementById('username').innerHTML=username;
  });
  
  var app = angular.module('adduser', []);
  //Start : Generate Json
  
  //Genareate File objects
    $('input:file').each( function(){
        $(this).after('<input type="text" readonly name="' + $(this).attr("id").replace("_", " ") + '" hidden value=""/>');
      });
      
      
      // When the user selects a file to be uploaded...
      $('input:file').change( function(){
      
        // If a file is selected set the text input value as the filename
        if($(this).get(0).files.length !== 0){
          $(this).next('input:text').val($(this).get(0).files[0].name);
        }
      
      });
      
    $.fn.serializeObject = function()
    {
        var o = {};
        var a = this.serializeArray();
        $.each(a, function() {
            if (o[this.name] !== undefined) {
                if (!o[this.name].push) {
                    o[this.name] = [o[this.name]];
                }
                o[this.name].push(this.value || '');
            } else {
                o[this.name] = this.value || '';
            }
        });
        return o;
    };
  
  
var jsonData;
    

    app.controller('adduserController', function($scope) {


      $scope.submitForm = function () {
        document.getElementById("loader").style.display = "block";
        var result = JSON.stringify($('form').serializeObject());
        // $('#result').text(JSON.stringify($('form').serializeObject()));

        console.log("result++++ "+result);
        fetch("https://apimsdcm.azure-api.net/dcmAPIM/updateuser", {
              method: 'post',
            // mode: 'no-cors', // no-cors, *cors, same-origin

                headers: { 'Content-Type': 'application/json',
                  "x-functions-key": "Y75v69weCc0+ZanTjf0jSihLRlZAOUJGRM8xTAbdDLMZdQiXYNiJfg==",
                  "Ocp-Apim-Subscription-Key": "2584a9c08dd04aa49db05cbb265c9b91",
                  // "subscription-key":"da91fd77-c908-4f23-9469-52acf3239a11"
                  },
              body: result
          }).then((response) => {

     
      // updatedata(jsonData);

                if (response.ok) {
                    toastr.success('PCMH User Update Successfully!.');
                } else {
                  toastr.error('Erro in Updating PCMH User!.');
                }
                document.getElementById("loader").style.display = "none";
                setTimeout(function() {
                  loadUserpage();

                },2000);
            })
            .catch(error => {
                console.log("Errroorrr "+error)
            }) 
    };

    var pcmhdata='{"pcmhid":-1}';
    fetch("https://apimsdcm.azure-api.net/dcmAPIM/PCMHData", {
        method: 'post',
       // mode: 'no-cors', // no-cors, *cors, same-origin

       headers: { 'Content-Type': 'application/json',
            "x-functions-key": "Y75v69weCc0+ZanTjf0jSihLRlZAOUJGRM8xTAbdDLMZdQiXYNiJfg==",
            "Ocp-Apim-Subscription-Key": "2584a9c08dd04aa49db05cbb265c9b91",
            // "subscription-key":"da91fd77-c908-4f23-9469-52acf3239a11"
            },
        body: pcmhdata
    }).then((response) => {

                     if (response.ok) {
                    return response
                } else {
                    throw `update Looks like something went wrong. Status: ${response}`;
                }
            })
            .then(response => response.json())
            .then(data => {
             
                console.log("data: " + JSON.stringify(data))
                
                pcmdata = JSON.stringify(data);
               
               
                select = document.getElementById('pcmh');
                for(var i=0;i<data.length;i++)
                {
                  var opt = document.createElement('option');
                  
                  opt.value = data[i].pcmhid;
                  opt.innerHTML = data[i].pcmhname;
                
                  select.appendChild(opt);
                
                  console.log("pcmhname = "+data[i].pcmhname);
                }
                
               
            })
            .catch(error => {
                console.log("error")
            }) 
           
            
            //Fetch Usertypes
            //var pcmhdata='{"pcmhid":-1}';
         fetch("https://apimsdcm.azure-api.net/dcmAPIM/getusertypes", {
            method: 'post',
       // mode: 'no-cors', // no-cors, *cors, same-origin

            headers: { 'Content-Type': 'application/json',
            "x-functions-key": "Y75v69weCc0+ZanTjf0jSihLRlZAOUJGRM8xTAbdDLMZdQiXYNiJfg==",
            "Ocp-Apim-Subscription-Key": "2584a9c08dd04aa49db05cbb265c9b91",
            // "subscription-key":"da91fd77-c908-4f23-9469-52acf3239a11"
            },
             body: {"test":"test"}
             }).then((response) => {

                     if (response.ok) {
                    return response
                } else {
                    throw `update Looks like something went wrong. Status: ${response}`;
                }
            })
            .then(response => response.json())
            .then(data => {
             
                console.log("Usertypes : " + JSON.stringify(data))
                
                pcmdata = JSON.stringify(data);
               
               
                select = document.getElementById('usertypes');
                for(var i=0;i<data.length;i++)
                {
                    var opt = document.createElement('option');
                    
                    opt.value = data[i].usertypeid;
                    opt.innerHTML = data[i].usertype;
                  
                    select.appendChild(opt);
                  
                    console.log("pcmhname = "+data[i].usertype);
                }
                
               
            })
            .catch(error => {
                console.log("error")
            }) 

      
   

    
    


      $scope.resetForm = function() {
        //$scope.user = {};
        $scope.form.$setPristine();
      }

    

    });

  //End : Generate Json

  function GetUserata(userid)
  {

    console.log("GetUserata");
    document.getElementById("loader").style.display = "block";
    var data='{"userid":'+userid+'}';
    fetch("https://apimsdcm.azure-api.net/dcmAPIM/getuserbyid", {
        method: 'post',
         // mode: 'no-cors', // no-cors, *cors, same-origin

        headers: { 'Content-Type': 'application/json',
            "x-functions-key": "Y75v69weCc0+ZanTjf0jSihLRlZAOUJGRM8xTAbdDLMZdQiXYNiJfg==",
            "Ocp-Apim-Subscription-Key": "2584a9c08dd04aa49db05cbb265c9b91",
            // "subscription-key":"da91fd77-c908-4f23-9469-52acf3239a11"
            },
        body: data
        }).then((response) => {

                    if (response.ok) {
                    return response
                } else {
                    throw `update Looks like something went wrong. Status: ${response}`;
                }
            })
            .then(response => response.json())
            .then(data => {
                console.log("user data: [" + JSON.stringify(data)+"]");

                // $scope.user.pcmh = data.pcmhid;
                document.getElementById('pcmh').value = data.pcmhid;
                document.getElementById('userid').value = data.userid;
                document.getElementById('usertypes').value = data.usertypeid;
                document.getElementById('password').value = data.password;
                document.getElementById('pcmh_user_id').value = data.username;
                document.getElementById('address').value = data.address;
                document.getElementById('email').value = data.email;
                document.getElementById('phone_no').value = data.phone;
                document.getElementById('lastname').value = data.lastname;
                document.getElementById('firstname').value = data.firstname;
                document.getElementById("loader").style.display = "none";
                // document.getElementById('pcmh_user_id').value = data.pcmhuserid;
                
              
              })
              .catch(error => {
                document.getElementById("loader").style.display = "none";
                console.log(error)
             })  
    //End : Get PCMH Data by using PCMHID
  }
  </script>


